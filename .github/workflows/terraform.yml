name: Terraform
on:
  push:
    branches:
      - develop
#    paths:
#      - 'infra/**'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: "actions/checkout@v3"

      - uses: ./.github/actions/setup-google-cloud-auth
        id: "auth"
        with:
          google_cloud_token: ${{ secrets.GOOGLE_CLOUD_TOKEN_STAGING }}

      - uses: ./.github/actions/terraform-apply
        with:
          environment: "staging"
          terraform-bucket: ${{ vars.FVST_PROJECT_TF_STATE_BUCKET_STAGING }}
          region: ${{ vars.FVST_PROJECT_REGION }}
          prefix: ${{ vars.FVST_PROJECT_PREFIX }}
